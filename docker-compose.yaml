version: '3.8'
services:
 backend:
  build:
   context: ./recommender-back/
   dockerfile: Dockerfile
  environment:
   REQUEST_ORIGIN: http://localhost:3000
  ports:
   - 5000:5000
  #command:
   #flask run --host=0.0.0.0

 celeryworker:
  build:
    context: ./recommender-back/
    dockerfile: Dockerfile
  command: ["celery", "-A", "src.app:celery", "worker", "--loglevel=info"]
  depends_on:
    - backend
    - redis

 celerybeat:
  build:
   context: ./recommender-back/
   dockerfile: Dockerfile
  command: ["celery", "-A", "src.app:celery", "beat"]
  depends_on:
   - backend
   - redis
   - celeryworker
 
 frontend:
  build:
   context: ./recommender-front/
   dockerfile: Dockerfile
  env_file:
   - ./recommender-front/.env.local
  ports:
   - 3000:3000

 redis:
  image: redis:latest
  ports:
   - 6379:6379
